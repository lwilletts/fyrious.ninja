#!/bin/sh
#
# wildefyr - 2016 (c) CC
# launch dmenu filled with program suggestions and geometry set

CACHE="$HOME/.cache/drun"

. fyrerc
. ~/.zsh/environment.zsh

printf '%s\n' "$EXECPATHS" | while read -r EXECPATH; do
    find "$EXECPATH" -maxdepth 1 -type f -executable | rev | \
        cut -d'/' -f 1 | rev >> $CACHE
    find "$EXECPATH" -maxdepth 1 -type l -executable | rev | \
        cut -d'/' -f 1 | rev >> $CACHE
done

unset $EXECPATH

barx=$((0))
bary=$((0))
barw=$((SW))
barh=$((25 - BW))

bar_font=$(awk '/.font/ {print $3}' < ~/.Xresources)

cat $CACHE | sort | uniq -u | dmenu -f -x $barx -y $bary -w $barw -h $barh -l 0 \
    -fn $bar_font -nf '#D7D7D7' -sf '#B23450' -nb '#03070B' -sb '#03070B' | \
    ${SHELL:-"/bin/zsh"}

rm -f $CACHE
